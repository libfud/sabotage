[mirrors]
http://cdn.mysql.com/Downloads/MySQL-5.6/mysql-5.6.11.tar.gz

[main]
filesize=35458544
sha512=d87d9eba5d86a5e4b4defff5755eaff4e76041520398b63dfc6bdd11604d46877ef0c57cced169d6d1fd03cb679c165b6731c6f48eceea70e48d5fc5bad7e2ab

[deps]
cmake
ncurses
readline

[build]
patch -p1 < "$K"/mysql-srv_buf_size.patch || exit 1
patch -p1 < "$K"/mysql-libedit.patch || exit 1

mkdir build && cd build

cmake \
  -DCMAKE_INSTALL_PREFIX=$butch_prefix \
  -DINSTALL_DOCDIR=share/doc/mysql \
  -DINSTALL_DOCREADMEDIR=share/doc/mysql \
  -DINSTALL_INCLUDEDIR=include/mysql \
  -DINSTALL_INFODIR=share/info \
  -DINSTALL_MANDIR=share/man \
  -DINSTALL_MYSQLDATADIR=$butch_prefix/srv/mysql \
  -DINSTALL_MYSQLSHAREDIR=share/mysql \
  -DINSTALL_MYSQLTESTDIR=share/mysql/test \
  -DINSTALL_PLUGINDIR=lib/mysql \
  -DINSTALL_SBINDIR=sbin \
  -DINSTALL_SCRIPTDIR=bin \
  -DINSTALL_SQLBENCHDIR=share/mysql/bench \
  -DINSTALL_SUPPORTFILESDIR=share/mysql/support \
  -DMYSQL_DATADIR=/srv/mysql \
  -DMYSQL_UNIX_ADDR=/var/run/mysql/mysql.sock \
  -DSYSCONFDIR=/etc \
  -DWITH_PARTITION_STORAGE_ENGINE=OFF \
  -DWITH_PERFSCHEMA_STORAGE_ENGINE=OFF \
  -DWITH_ATOMIC_LOCKS=ON \
  -DWITH_SSL=system \
  -DWITH_ZLIB=system \
  -DWITH_PIC=ON \
  -DENABLE_PROFILING=OFF \
  -DWITH_DEBUG=OFF \
  -DWITH_UNIT_TESTS=OFF \
  -DMANUFACTURER=YourMOM \
  -DWITH_EXTRA_CHARSETS=none \
  -DCMAKE_BUILD_TYPE=MinSizeRel \
  -DCMAKE_C_FLAGS="-D__STDC_ISO_10646__ -DSHM_R=0400 -DSHM_W=0400" \
  -DWITH_READLINE=OFF \
  -DWITH_LIBEDIT=system \
      .. || exit 1

sed -i 's@/\* #undef DEFAULT_CHARSET_HOME \*/@#define DEFAULT_CHARSET_HOME ""@' include/config.h
sed -i 's@/\* #undef DEFAULT_CHARSET_HOME \*/@#define DEFAULT_CHARSET_HOME ""@' include/my_config.h

sed -i 's@/\* #undef DEFAULT_MYSQL_HOME \*/@#define DEFAULT_MYSQL_HOME ""@' include/config.h
sed -i 's@/\* #undef DEFAULT_MYSQL_HOME \*/@#define DEFAULT_MYSQL_HOME ""@' include/my_config.h

make -j$MAKE_THREADS VERBOSE=1 || exit 1

#  -DWITH_READLINE=OFF \
#  -DWITH_LIBEDIT=system \

# possible CMAKE_BUILD_TYPEs: Debug, Release, RelWithDebInfo and MinSizeRel

SEGMENTS="Client Server IniFiles ManPages SharedLibraries"
SEGMENTS="$SEGMENTS Development Documentation Info Readme"

# FIXME: the cmake crap doesnt know how to install into DESTDIR

for segment in $SEGMENTS; do
   cmake DESTDIR=$butch_install_dir -DCMAKE_INSTALL_COMPONENT=$segment -P cmake_install.cmake
done

unset SEGMENTS


#CFLAGS=-D_GNU_SOURCE ./configure -C --prefix="$butch_prefix" || exit 1
#make -j$MAKE_THREADS || exit 1
#make DESTDIR="$butch_install_dir" install || exit 1
